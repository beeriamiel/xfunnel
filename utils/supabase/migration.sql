##tables
| table_schema | table_name              | columns                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------ | ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| auth         | audit_log_entries       | instance_id uuid,
    payload json,
    id uuid NOT NULL,
    created_at timestamp with time zone,
    ip_address character varying(64) NOT NULL DEFAULT ''::character varying                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| auth         | flow_state              | provider_access_token text,
    user_id uuid,
    authentication_method text NOT NULL,
    id uuid NOT NULL,
    auth_code_issued_at timestamp with time zone,
    provider_type text NOT NULL,
    created_at timestamp with time zone,
    auth_code text NOT NULL,
    updated_at timestamp with time zone,
    code_challenge text NOT NULL,
    code_challenge_method USER-DEFINED NOT NULL,
    provider_refresh_token text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| auth         | identities              | user_id uuid NOT NULL,
    created_at timestamp with time zone,
    provider text NOT NULL,
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    identity_data jsonb NOT NULL,
    last_sign_in_at timestamp with time zone,
    updated_at timestamp with time zone,
    email text,
    provider_id text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| auth         | instances               | raw_base_config text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    uuid uuid,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| auth         | mfa_amr_claims          | session_id uuid NOT NULL,
    id uuid NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    authentication_method text NOT NULL,
    created_at timestamp with time zone NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| auth         | mfa_challenges          | otp_code text,
    id uuid NOT NULL,
    verified_at timestamp with time zone,
    ip_address inet NOT NULL,
    web_authn_session_data jsonb,
    created_at timestamp with time zone NOT NULL,
    factor_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| auth         | mfa_factors             | user_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    friendly_name text,
    phone text,
    web_authn_credential jsonb,
    id uuid NOT NULL,
    secret text,
    factor_type USER-DEFINED NOT NULL,
    status USER-DEFINED NOT NULL,
    web_authn_aaguid uuid,
    last_challenged_at timestamp with time zone,
    updated_at timestamp with time zone NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| auth         | one_time_tokens         | updated_at timestamp without time zone NOT NULL DEFAULT now(),
    user_id uuid NOT NULL,
    created_at timestamp without time zone NOT NULL DEFAULT now(),
    token_type USER-DEFINED NOT NULL,
    relates_to text NOT NULL,
    id uuid NOT NULL,
    token_hash text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| auth         | refresh_tokens          | revoked boolean,
    parent character varying(255),
    id bigint NOT NULL DEFAULT nextval('auth.refresh_tokens_id_seq'::regclass),
    user_id character varying(255),
    session_id uuid,
    instance_id uuid,
    created_at timestamp with time zone,
    token character varying(255),
    updated_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| auth         | saml_providers          | created_at timestamp with time zone,
    sso_provider_id uuid NOT NULL,
    metadata_url text,
    attribute_mapping jsonb,
    metadata_xml text NOT NULL,
    name_id_format text,
    updated_at timestamp with time zone,
    entity_id text NOT NULL,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| auth         | saml_relay_states       | id uuid NOT NULL,
    created_at timestamp with time zone,
    for_email text,
    updated_at timestamp with time zone,
    flow_state_id uuid,
    redirect_to text,
    request_id text NOT NULL,
    sso_provider_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| auth         | schema_migrations       | version character varying(255) NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| auth         | sessions                | ip inet,
    aal USER-DEFINED,
    user_agent text,
    factor_id uuid,
    tag text,
    updated_at timestamp with time zone,
    created_at timestamp with time zone,
    not_after timestamp with time zone,
    refreshed_at timestamp without time zone,
    user_id uuid NOT NULL,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| auth         | sso_domains             | sso_provider_id uuid NOT NULL,
    domain text NOT NULL,
    updated_at timestamp with time zone,
    id uuid NOT NULL,
    created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| auth         | sso_providers           | resource_id text,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| auth         | users                   | email_change character varying(255),
    invited_at timestamp with time zone,
    confirmed_at timestamp with time zone,
    banned_until timestamp with time zone,
    email_confirmed_at timestamp with time zone,
    email_change_token_current character varying(255) DEFAULT ''::character varying,
    phone_change_token character varying(255) DEFAULT ''::character varying,
    recovery_token character varying(255),
    phone_change_sent_at timestamp with time zone,
    reauthentication_token character varying(255) DEFAULT ''::character varying,
    confirmation_token character varying(255),
    created_at timestamp with time zone,
    is_sso_user boolean NOT NULL DEFAULT false,
    raw_app_meta_data jsonb,
    is_anonymous boolean NOT NULL DEFAULT false,
    encrypted_password character varying(255),
    email_change_confirm_status smallint DEFAULT 0,
    aud character varying(255),
    raw_user_meta_data jsonb,
    instance_id uuid,
    deleted_at timestamp with time zone,
    recovery_sent_at timestamp with time zone,
    phone text DEFAULT NULL::character varying,
    reauthentication_sent_at timestamp with time zone,
    email_change_sent_at timestamp with time zone,
    email_change_token_new character varying(255),
    confirmation_sent_at timestamp with time zone,
    role character varying(255),
    phone_change text DEFAULT ''::character varying,
    phone_confirmed_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    email character varying(255),
    updated_at timestamp with time zone,
    id uuid NOT NULL,
    is_super_admin boolean |
| public       | batch_metadata          | completed_at timestamp with time zone,
    error_message text,
    created_at timestamp with time zone DEFAULT now(),
    batch_type text NOT NULL,
    company_id bigint,
    status text NOT NULL,
    metadata jsonb,
    batch_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public       | citations               | icp_vertical text,
    company_mentioned boolean,
    domain_authority bigint,
    ranking_position integer,
    external_links_to_root_domain integer,
    rank_list text,
    moz_last_updated timestamp with time zone,
    response_analysis_id bigint NOT NULL,
    id bigint NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    response_text text,
    query_text text,
    page_authority integer,
    moz_last_crawled timestamp with time zone,
    source_type text,
    root_domains_to_root_domain integer,
    spam_score integer,
    buyer_journey_phase text,
    mentioned_companies ARRAY,
    company_id bigint NOT NULL,
    buyer_persona text,
    content_analysis text,
    citation_order integer NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    citation_url text NOT NULL,
    region text,
    recommended boolean                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public       | companies               | markets_operating_in ARRAY DEFAULT '{}'::text[],
    created_at timestamp with time zone DEFAULT now(),
    industry text,
    main_products ARRAY DEFAULT '{}'::text[],
    product_category text,
    number_of_employees integer,
    name text NOT NULL,
    annual_revenue text,
    id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public       | competitors             | competitor_name text NOT NULL,
    id bigint NOT NULL,
    company_id bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public       | generation_progress     | updated_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    id bigint NOT NULL,
    progress integer NOT NULL,
    company_id bigint NOT NULL,
    error_message text,
    status text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | ideal_customer_profiles | created_by_batch boolean DEFAULT false,
    region text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    icp_batch_id uuid DEFAULT gen_random_uuid(),
    company_size text NOT NULL,
    company_id bigint,
    id bigint NOT NULL,
    vertical text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public       | persona_response_stats  | total_batches bigint,
    persona_title text,
    persona_id bigint,
    questions_with_responses bigint,
    latest_response_date timestamp with time zone,
    total_questions bigint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | personas                | title text NOT NULL,
    icp_id bigint,
    id bigint NOT NULL,
    seniority_level text NOT NULL,
    department text NOT NULL,
    created_at timestamp with time zone DEFAULT now()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | prompt_logs             | created_at timestamp with time zone DEFAULT now(),
    prompt_template_ids ARRAY NOT NULL,
    context_data jsonb,
    id bigint NOT NULL,
    system_prompt text NOT NULL,
    persona_id bigint,
    user_prompt text NOT NULL,
    company_id bigint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | prompts                 | name text NOT NULL,
    prompt_type text,
    is_active boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    prompt_text text NOT NULL,
    updated_at timestamp with time zone DEFAULT now(),
    id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public       | queries                 | prompt_id bigint,
    buyer_journey_phase ARRAY,
    persona_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    query_batch_id uuid DEFAULT gen_random_uuid(),
    query_text text NOT NULL,
    company_id bigint,
    id bigint NOT NULL,
    created_by_batch boolean DEFAULT false,
    user_id uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | response_analysis       | created_at timestamp with time zone DEFAULT now(),
    geographic_region text,
    buyer_persona text,
    response_id bigint,
    query_id bigint,
    solution_analysis jsonb,
    answer_engine text NOT NULL,
    company_mentioned boolean DEFAULT false,
    query_text text,
    competitors_list ARRAY DEFAULT '{}'::text[],
    created_by_batch boolean DEFAULT false,
    recommended boolean,
    rank_list text,
    icp_vertical text,
    citations_parsed jsonb,
    buying_journey_stage text,
    ranking_position integer,
    sentiment_score double precision,
    response_text text,
    mentioned_companies ARRAY DEFAULT '{}'::text[],
    company_id bigint NOT NULL,
    prompt_id bigint,
    company_name text NOT NULL,
    prompt_name text,
    cited boolean,
    id bigint NOT NULL,
    industry_vertical text,
    analysis_batch_id uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public       | response_analysis_view  | industry_vertical text,
    buyer_persona text,
    sentiment_score double precision,
    recommended boolean,
    company_mentioned boolean,
    ranking_position integer,
    id bigint,
    created_at timestamp with time zone,
    response_id bigint,
    citations_parsed jsonb,
    geographic_region text,
    buying_journey_stage text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | responses               | response_batch_id uuid DEFAULT gen_random_uuid(),
    created_by_batch boolean DEFAULT false,
    answer_engine text,
    url text,
    id bigint NOT NULL,
    citations ARRAY,
    created_at timestamp with time zone DEFAULT now(),
    query_id bigint,
    websearchqueries ARRAY,
    response_text text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
##indexes
| section  | table_schema | table_name              | indexes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -------- | ------------ | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| INDEXES: | auth         | audit_log_entries       | CREATE UNIQUE INDEX audit_log_entries_pkey ON auth.audit_log_entries USING btree (id)
CREATE INDEX audit_logs_instance_id_idx ON auth.audit_log_entries USING btree (instance_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| INDEXES: | auth         | flow_state              | CREATE INDEX idx_user_id_auth_method ON auth.flow_state USING btree (user_id, authentication_method)
CREATE INDEX flow_state_created_at_idx ON auth.flow_state USING btree (created_at DESC)
CREATE UNIQUE INDEX flow_state_pkey ON auth.flow_state USING btree (id)
CREATE INDEX idx_auth_code ON auth.flow_state USING btree (auth_code)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| INDEXES: | auth         | identities              | CREATE UNIQUE INDEX identities_pkey ON auth.identities USING btree (id)
CREATE INDEX identities_email_idx ON auth.identities USING btree (email text_pattern_ops)
CREATE INDEX identities_user_id_idx ON auth.identities USING btree (user_id)
CREATE UNIQUE INDEX identities_provider_id_provider_unique ON auth.identities USING btree (provider_id, provider)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| INDEXES: | auth         | instances               | CREATE UNIQUE INDEX instances_pkey ON auth.instances USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| INDEXES: | auth         | mfa_amr_claims          | CREATE UNIQUE INDEX mfa_amr_claims_session_id_authentication_method_pkey ON auth.mfa_amr_claims USING btree (session_id, authentication_method)
CREATE UNIQUE INDEX amr_id_pk ON auth.mfa_amr_claims USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| INDEXES: | auth         | mfa_challenges          | CREATE UNIQUE INDEX mfa_challenges_pkey ON auth.mfa_challenges USING btree (id)
CREATE INDEX mfa_challenge_created_at_idx ON auth.mfa_challenges USING btree (created_at DESC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| INDEXES: | auth         | mfa_factors             | CREATE UNIQUE INDEX mfa_factors_user_friendly_name_unique ON auth.mfa_factors USING btree (friendly_name, user_id) WHERE (TRIM(BOTH FROM friendly_name) <> ''::text)
CREATE INDEX factor_id_created_at_idx ON auth.mfa_factors USING btree (user_id, created_at)
CREATE INDEX mfa_factors_user_id_idx ON auth.mfa_factors USING btree (user_id)
CREATE UNIQUE INDEX unique_phone_factor_per_user ON auth.mfa_factors USING btree (user_id, phone)
CREATE UNIQUE INDEX mfa_factors_last_challenged_at_key ON auth.mfa_factors USING btree (last_challenged_at)
CREATE UNIQUE INDEX mfa_factors_pkey ON auth.mfa_factors USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| INDEXES: | auth         | one_time_tokens         | CREATE INDEX one_time_tokens_relates_to_hash_idx ON auth.one_time_tokens USING hash (relates_to)
CREATE UNIQUE INDEX one_time_tokens_user_id_token_type_key ON auth.one_time_tokens USING btree (user_id, token_type)
CREATE INDEX one_time_tokens_token_hash_hash_idx ON auth.one_time_tokens USING hash (token_hash)
CREATE UNIQUE INDEX one_time_tokens_pkey ON auth.one_time_tokens USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| INDEXES: | auth         | refresh_tokens          | CREATE INDEX refresh_tokens_updated_at_idx ON auth.refresh_tokens USING btree (updated_at DESC)
CREATE INDEX refresh_tokens_session_id_revoked_idx ON auth.refresh_tokens USING btree (session_id, revoked)
CREATE INDEX refresh_tokens_parent_idx ON auth.refresh_tokens USING btree (parent)
CREATE UNIQUE INDEX refresh_tokens_token_unique ON auth.refresh_tokens USING btree (token)
CREATE INDEX refresh_tokens_instance_id_user_id_idx ON auth.refresh_tokens USING btree (instance_id, user_id)
CREATE INDEX refresh_tokens_instance_id_idx ON auth.refresh_tokens USING btree (instance_id)
CREATE UNIQUE INDEX refresh_tokens_pkey ON auth.refresh_tokens USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| INDEXES: | auth         | saml_providers          | CREATE UNIQUE INDEX saml_providers_entity_id_key ON auth.saml_providers USING btree (entity_id)
CREATE UNIQUE INDEX saml_providers_pkey ON auth.saml_providers USING btree (id)
CREATE INDEX saml_providers_sso_provider_id_idx ON auth.saml_providers USING btree (sso_provider_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| INDEXES: | auth         | saml_relay_states       | CREATE INDEX saml_relay_states_created_at_idx ON auth.saml_relay_states USING btree (created_at DESC)
CREATE UNIQUE INDEX saml_relay_states_pkey ON auth.saml_relay_states USING btree (id)
CREATE INDEX saml_relay_states_for_email_idx ON auth.saml_relay_states USING btree (for_email)
CREATE INDEX saml_relay_states_sso_provider_id_idx ON auth.saml_relay_states USING btree (sso_provider_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| INDEXES: | auth         | schema_migrations       | CREATE UNIQUE INDEX schema_migrations_pkey ON auth.schema_migrations USING btree (version)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| INDEXES: | auth         | sessions                | CREATE INDEX user_id_created_at_idx ON auth.sessions USING btree (user_id, created_at)
CREATE UNIQUE INDEX sessions_pkey ON auth.sessions USING btree (id)
CREATE INDEX sessions_user_id_idx ON auth.sessions USING btree (user_id)
CREATE INDEX sessions_not_after_idx ON auth.sessions USING btree (not_after DESC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| INDEXES: | auth         | sso_domains             | CREATE UNIQUE INDEX sso_domains_pkey ON auth.sso_domains USING btree (id)
CREATE INDEX sso_domains_sso_provider_id_idx ON auth.sso_domains USING btree (sso_provider_id)
CREATE UNIQUE INDEX sso_domains_domain_idx ON auth.sso_domains USING btree (lower(domain))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| INDEXES: | auth         | sso_providers           | CREATE UNIQUE INDEX sso_providers_resource_id_idx ON auth.sso_providers USING btree (lower(resource_id))
CREATE UNIQUE INDEX sso_providers_pkey ON auth.sso_providers USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| INDEXES: | auth         | users                   | CREATE INDEX users_instance_id_idx ON auth.users USING btree (instance_id)
CREATE UNIQUE INDEX users_email_partial_key ON auth.users USING btree (email) WHERE (is_sso_user = false)
CREATE UNIQUE INDEX users_phone_key ON auth.users USING btree (phone)
CREATE INDEX users_is_anonymous_idx ON auth.users USING btree (is_anonymous)
CREATE UNIQUE INDEX confirmation_token_idx ON auth.users USING btree (confirmation_token) WHERE ((confirmation_token)::text !~ '^[0-9 ]*$'::text)
CREATE INDEX users_instance_id_email_idx ON auth.users USING btree (instance_id, lower((email)::text))
CREATE UNIQUE INDEX users_pkey ON auth.users USING btree (id)
CREATE UNIQUE INDEX email_change_token_new_idx ON auth.users USING btree (email_change_token_new) WHERE ((email_change_token_new)::text !~ '^[0-9 ]*$'::text)
CREATE UNIQUE INDEX reauthentication_token_idx ON auth.users USING btree (reauthentication_token) WHERE ((reauthentication_token)::text !~ '^[0-9 ]*$'::text)
CREATE UNIQUE INDEX email_change_token_current_idx ON auth.users USING btree (email_change_token_current) WHERE ((email_change_token_current)::text !~ '^[0-9 ]*$'::text)
CREATE UNIQUE INDEX recovery_token_idx ON auth.users USING btree (recovery_token) WHERE ((recovery_token)::text !~ '^[0-9 ]*$'::text)                                                    |
| INDEXES: | public       | batch_metadata          | CREATE INDEX idx_batch_metadata_type ON public.batch_metadata USING btree (batch_type)
CREATE INDEX idx_batch_metadata_company ON public.batch_metadata USING btree (company_id)
CREATE UNIQUE INDEX batch_metadata_pkey ON public.batch_metadata USING btree (batch_id)
CREATE INDEX idx_batch_metadata_status ON public.batch_metadata USING btree (status)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| INDEXES: | public       | citations               | CREATE INDEX idx_citations_citation_order ON public.citations USING btree (citation_order)
CREATE INDEX idx_citations_created_at ON public.citations USING btree (created_at DESC)
CREATE INDEX idx_citations_moz_last_updated ON public.citations USING btree (moz_last_updated)
CREATE INDEX idx_citations_response_analysis_id ON public.citations USING btree (response_analysis_id)
CREATE INDEX idx_citations_company_id ON public.citations USING btree (company_id)
CREATE UNIQUE INDEX citations_pkey ON public.citations USING btree (id)
CREATE INDEX idx_citations_source_type ON public.citations USING btree (source_type)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| INDEXES: | public       | companies               | CREATE INDEX idx_companies_number_of_employees ON public.companies USING btree (number_of_employees)
CREATE UNIQUE INDEX companies_pkey ON public.companies USING btree (id)
CREATE INDEX idx_companies_product_category ON public.companies USING btree (product_category)
CREATE INDEX idx_companies_main_products ON public.companies USING gin (main_products)
CREATE INDEX idx_companies_markets ON public.companies USING gin (markets_operating_in)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| INDEXES: | public       | competitors             | CREATE UNIQUE INDEX competitors_pkey ON public.competitors USING btree (id)
CREATE INDEX idx_competitors_company_id ON public.competitors USING btree (company_id)
CREATE UNIQUE INDEX unique_competitor_per_company ON public.competitors USING btree (company_id, competitor_name)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| INDEXES: | public       | generation_progress     | CREATE INDEX idx_generation_progress_status ON public.generation_progress USING btree (status)
CREATE UNIQUE INDEX generation_progress_pkey ON public.generation_progress USING btree (id)
CREATE INDEX idx_generation_progress_company_id ON public.generation_progress USING btree (company_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| INDEXES: | public       | ideal_customer_profiles | CREATE UNIQUE INDEX ideal_customer_profiles_pkey ON public.ideal_customer_profiles USING btree (id)
CREATE UNIQUE INDEX unique_icp_batch_id ON public.ideal_customer_profiles USING btree (icp_batch_id)
CREATE INDEX idx_icp_batch_id ON public.ideal_customer_profiles USING btree (icp_batch_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| INDEXES: | public       | personas                | CREATE INDEX idx_personas_icp_id ON public.personas USING btree (icp_id)
CREATE UNIQUE INDEX personas_pkey ON public.personas USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| INDEXES: | public       | prompt_logs             | CREATE INDEX idx_prompt_logs_persona ON public.prompt_logs USING btree (persona_id)
CREATE UNIQUE INDEX prompt_logs_pkey ON public.prompt_logs USING btree (id)
CREATE INDEX idx_prompt_logs_company ON public.prompt_logs USING btree (company_id)
CREATE INDEX idx_prompt_logs_created_at ON public.prompt_logs USING btree (created_at)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| INDEXES: | public       | prompts                 | CREATE INDEX idx_prompts_is_active ON public.prompts USING btree (is_active)
CREATE UNIQUE INDEX prompts_pkey ON public.prompts USING btree (id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| INDEXES: | public       | queries                 | CREATE UNIQUE INDEX queries_pkey ON public.queries USING btree (id)
CREATE INDEX idx_queries_company_id ON public.queries USING btree (company_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| INDEXES: | public       | response_analysis       | CREATE INDEX idx_response_analysis_prompt_name ON public.response_analysis USING btree (prompt_name)
CREATE INDEX idx_response_analysis_prompt ON public.response_analysis USING btree (prompt_id, created_at)
CREATE INDEX idx_response_analysis_metrics ON public.response_analysis USING btree (sentiment_score, ranking_position, company_mentioned, recommended)
CREATE INDEX idx_response_analysis_groups ON public.response_analysis USING btree (geographic_region, industry_vertical, buyer_persona, buying_journey_stage)
CREATE INDEX idx_response_analysis_company_name ON public.response_analysis USING btree (company_name)
CREATE INDEX idx_response_analysis_response_id ON public.response_analysis USING btree (response_id)
CREATE INDEX idx_response_analysis_batch ON public.response_analysis USING btree (analysis_batch_id)
CREATE INDEX idx_response_analysis_company_id ON public.response_analysis USING btree (company_id)
CREATE INDEX idx_response_analysis_answer_engine ON public.response_analysis USING btree (answer_engine)
CREATE INDEX idx_response_analysis_query_id ON public.response_analysis USING btree (query_id)
CREATE UNIQUE INDEX response_analysis_pkey ON public.response_analysis USING btree (id)
CREATE INDEX idx_response_analysis_solution ON public.response_analysis USING gin (solution_analysis) |
| INDEXES: | public       | responses               | CREATE UNIQUE INDEX responses_pkey ON public.responses USING btree (id)
CREATE INDEX idx_responses_query_id ON public.responses USING btree (query_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

##triggers
| section            | table_schema | table_name          | check_constraints                                                                                                                                                                                                                                                                                      |
| ------------------ | ------------ | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| CHECK CONSTRAINTS: | auth         | one_time_tokens     | one_time_tokens_token_hash_check CHECK ((char_length(token_hash) > 0))                                                                                                                                                                                                                                 |
| CHECK CONSTRAINTS: | auth         | saml_providers      | entity_id not empty CHECK ((char_length(entity_id) > 0))
metadata_url not empty CHECK (((metadata_url = NULL::text) OR (char_length(metadata_url) > 0)))
metadata_xml not empty CHECK ((char_length(metadata_xml) > 0))                                                                                |
| CHECK CONSTRAINTS: | auth         | saml_relay_states   | request_id not empty CHECK ((char_length(request_id) > 0))                                                                                                                                                                                                                                             |
| CHECK CONSTRAINTS: | auth         | sso_domains         | domain not empty CHECK ((char_length(domain) > 0))                                                                                                                                                                                                                                                     |
| CHECK CONSTRAINTS: | auth         | sso_providers       | resource_id not empty CHECK (((resource_id = NULL::text) OR (char_length(resource_id) > 0)))                                                                                                                                                                                                           |
| CHECK CONSTRAINTS: | auth         | users               | users_email_change_confirm_status_check CHECK (((email_change_confirm_status >= 0) AND (email_change_confirm_status <= 2)))                                                                                                                                                                            |
| CHECK CONSTRAINTS: | public       | batch_metadata      | batch_metadata_batch_type_check CHECK ((batch_type = ANY (ARRAY['icp'::text, 'query'::text, 'response'::text, 'response_analysis'::text, 'citations_moz'::text])))
batch_metadata_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'completed'::text, 'failed'::text]))) |
| CHECK CONSTRAINTS: | public       | companies           | valid_markets CHECK ((markets_operating_in <@ ARRAY['north_america'::text, 'europe'::text, 'asia_pacific'::text, 'middle_east'::text, 'latin_america'::text]))                                                                                                                                         |
| CHECK CONSTRAINTS: | public       | generation_progress | generation_progress_progress_check CHECK (((progress >= 0) AND (progress <= 100)))
generation_progress_status_check CHECK ((status = ANY (ARRAY['generating_icps'::text, 'generating_questions'::text, 'complete'::text, 'failed'::text])))                                                            |
| CHECK CONSTRAINTS: | public       | queries             | queries_buyer_journey_phase_check CHECK (((array_length(buyer_journey_phase, 1) = 1) AND (buyer_journey_phase <@ ARRAY['problem_exploration'::text, 'solution_education'::text, 'solution_comparison'::text, 'solution_evaluation'::text, 'final_research'::text])))                                   |
| CHECK CONSTRAINTS: | public       | responses           | responses_answer_engine_check CHECK ((answer_engine = ANY (ARRAY['openai'::text, 'gemini'::text, 'perplexity'::text, 'claude'::text, 'google_search'::text, 'llama'::text])))                                                                                                                          |INTS: | public       | responses           | responses_answer_engine_check CHECK ((answer_engine = ANY (ARRAY['openai'::text, 'gemini'::text, 'perplexity'::text, 'claude'::text, 'google_search'::text, 'llama'::text])))                                                                                                   |

##rls Policies

| schema_name | table_name              | policy_name                                  | permissive | roles         | command | using_expression                                                                                                    | with_check_expression                 |
| ----------- | ----------------------- | -------------------------------------------- | ---------- | ------------- | ------- | ------------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
| public      | citations               | Enable insert for authenticated users        | PERMISSIVE | authenticated | INSERT  |                                                                                                                     | true                                  |
| public      | citations               | Enable read access for authenticated users   | PERMISSIVE | authenticated | SELECT  | true                                                                                                                |                                       |
| public      | citations               | Enable update for authenticated users        | PERMISSIVE | authenticated | UPDATE  | true                                                                                                                | true                                  |
| public      | companies               | Enable read access for all users             | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | companies               | Users can insert companies                   | PERMISSIVE | authenticated | INSERT  |                                                                                                                     | true                                  |
| public      | generation_progress     | Enable read access for all users             | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | ideal_customer_profiles | Enable insert access for authenticated users | PERMISSIVE |               | INSERT  |                                                                                                                     | true                                  |
| public      | ideal_customer_profiles | Enable read access for all users             | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | personas                | Enable insert access for authenticated users | PERMISSIVE |               | INSERT  |                                                                                                                     | true                                  |
| public      | personas                | Enable read access for all users             | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | prompts                 | Allow reading prompts                        | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | prompts                 | Authenticated users can manage prompts       | PERMISSIVE | authenticated | ALL     | true                                                                                                                | true                                  |
| public      | queries                 | Allow reading queries                        | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | queries                 | Users can insert their own data              | PERMISSIVE |               | INSERT  |                                                                                                                     | (user_id = auth.uid())                |
| public      | queries                 | Users can update their own queries           | PERMISSIVE |               | UPDATE  | (user_id = auth.uid())                                                                                              | (user_id = auth.uid())                |
| public      | response_analysis       | Allow viewing all response analyses          | PERMISSIVE |               | ALL     | true                                                                                                                |                                       |
| public      | responses               | Enable insert for authenticated users        | PERMISSIVE |               | INSERT  |                                                                                                                     | (auth.role() = 'authenticated'::text) |
| public      | responses               | Enable read access for all users             | PERMISSIVE |               | SELECT  | true                                                                                                                |                                       |
| public      | responses               | Users can view responses to their queries    | PERMISSIVE |               | ALL     | (EXISTS ( SELECT 1
   FROM queries
  WHERE ((queries.id = responses.query_id) AND (queries.user_id = auth.uid())))) |                                       |

-- First create the enum type
CREATE TYPE citation_source_type AS ENUM ('OWNED', 'COMPETITOR', 'UGC', 'EARNED');

-- Map existing values to new enum values
UPDATE citations 
SET source_type = CASE 
    WHEN source_type IS NULL OR source_type = '' THEN 'EARNED'
    WHEN source_type = 'Affiliate' THEN 'EARNED'
    WHEN source_type = 'Documentation' THEN 'EARNED'
    WHEN source_type = 'Blog' THEN 'EARNED'
    WHEN source_type = 'GitHub' THEN 'EARNED'
    WHEN source_type = 'Guide' THEN 'EARNED'
    WHEN source_type = 'Tutorial' THEN 'EARNED'
    ELSE 'EARNED'
END;

-- Now we can safely alter the column
ALTER TABLE citations 
  ALTER COLUMN source_type TYPE citation_source_type 
  USING source_type::citation_source_type;

-- Add NOT NULL constraint with default
ALTER TABLE citations 
  ALTER COLUMN source_type SET NOT NULL,
  ALTER COLUMN source_type SET DEFAULT 'EARNED';
