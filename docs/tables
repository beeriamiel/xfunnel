| table_schema | table_name                | columns                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------ | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| auth         | audit_log_entries         | payload json,
    ip_address character varying(64) NOT NULL DEFAULT ''::character varying,
    id uuid NOT NULL,
    instance_id uuid,
    created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| auth         | flow_state                | authentication_method text NOT NULL,
    created_at timestamp with time zone,
    id uuid NOT NULL,
    updated_at timestamp with time zone,
    auth_code_issued_at timestamp with time zone,
    auth_code text NOT NULL,
    code_challenge text NOT NULL,
    code_challenge_method USER-DEFINED NOT NULL,
    provider_type text NOT NULL,
    provider_access_token text,
    provider_refresh_token text,
    user_id uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| auth         | identities                | created_at timestamp with time zone,
    updated_at timestamp with time zone,
    provider_id text NOT NULL,
    last_sign_in_at timestamp with time zone,
    identity_data jsonb NOT NULL,
    user_id uuid NOT NULL,
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    email text,
    provider text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| auth         | instances                 | created_at timestamp with time zone,
    raw_base_config text,
    updated_at timestamp with time zone,
    uuid uuid,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| auth         | mfa_amr_claims            | updated_at timestamp with time zone NOT NULL,
    id uuid NOT NULL,
    session_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    authentication_method text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| auth         | mfa_challenges            | created_at timestamp with time zone NOT NULL,
    verified_at timestamp with time zone,
    ip_address inet NOT NULL,
    web_authn_session_data jsonb,
    otp_code text,
    id uuid NOT NULL,
    factor_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| auth         | mfa_factors               | friendly_name text,
    id uuid NOT NULL,
    status USER-DEFINED NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    last_challenged_at timestamp with time zone,
    web_authn_aaguid uuid,
    phone text,
    web_authn_credential jsonb,
    factor_type USER-DEFINED NOT NULL,
    user_id uuid NOT NULL,
    secret text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| auth         | one_time_tokens           | token_hash text NOT NULL,
    relates_to text NOT NULL,
    updated_at timestamp without time zone NOT NULL DEFAULT now(),
    created_at timestamp without time zone NOT NULL DEFAULT now(),
    token_type USER-DEFINED NOT NULL,
    user_id uuid NOT NULL,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| auth         | refresh_tokens            | revoked boolean,
    parent character varying(255),
    user_id character varying(255),
    token character varying(255),
    session_id uuid,
    updated_at timestamp with time zone,
    created_at timestamp with time zone,
    instance_id uuid,
    id bigint NOT NULL DEFAULT nextval('auth.refresh_tokens_id_seq'::regclass)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| auth         | saml_providers            | name_id_format text,
    updated_at timestamp with time zone,
    created_at timestamp with time zone,
    metadata_url text,
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    attribute_mapping jsonb,
    metadata_xml text NOT NULL,
    entity_id text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| auth         | saml_relay_states         | request_id text NOT NULL,
    updated_at timestamp with time zone,
    created_at timestamp with time zone,
    sso_provider_id uuid NOT NULL,
    id uuid NOT NULL,
    flow_state_id uuid,
    redirect_to text,
    for_email text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| auth         | schema_migrations         | version character varying(255) NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| auth         | sessions                  | factor_id uuid,
    aal USER-DEFINED,
    not_after timestamp with time zone,
    refreshed_at timestamp without time zone,
    ip inet,
    created_at timestamp with time zone,
    user_agent text,
    tag text,
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    updated_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| auth         | sso_domains               | created_at timestamp with time zone,
    domain text NOT NULL,
    sso_provider_id uuid NOT NULL,
    updated_at timestamp with time zone,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| auth         | sso_providers             | created_at timestamp with time zone,
    resource_id text,
    updated_at timestamp with time zone,
    id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| auth         | users                     | phone text DEFAULT NULL::character varying,
    email_change_token_new character varying(255),
    email_change character varying(255),
    phone_change text DEFAULT ''::character varying,
    phone_change_token character varying(255) DEFAULT ''::character varying,
    email_change_token_current character varying(255) DEFAULT ''::character varying,
    reauthentication_token character varying(255) DEFAULT ''::character varying,
    role character varying(255),
    aud character varying(255),
    instance_id uuid,
    id uuid NOT NULL,
    email_confirmed_at timestamp with time zone,
    invited_at timestamp with time zone,
    confirmation_sent_at timestamp with time zone,
    recovery_sent_at timestamp with time zone,
    email_change_sent_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    raw_app_meta_data jsonb,
    raw_user_meta_data jsonb,
    is_super_admin boolean,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    phone_confirmed_at timestamp with time zone,
    phone_change_sent_at timestamp with time zone,
    confirmed_at timestamp with time zone,
    email_change_confirm_status smallint DEFAULT 0,
    banned_until timestamp with time zone,
    reauthentication_sent_at timestamp with time zone,
    is_sso_user boolean NOT NULL DEFAULT false,
    deleted_at timestamp with time zone,
    is_anonymous boolean NOT NULL DEFAULT false,
    recovery_token character varying(255),
    confirmation_token character varying(255),
    encrypted_password character varying(255),
    email character varying(255) |
| public       | account_users             | account_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    user_id uuid NOT NULL,
    role text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public       | accounts                  | plan_type text NOT NULL,
    account_type text NOT NULL,
    name text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    monthly_credits_available integer NOT NULL DEFAULT 0,
    monthly_credits_used integer NOT NULL DEFAULT 0,
    credits_renewal_date timestamp with time zone,
    last_update_date timestamp with time zone DEFAULT now()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| public       | ai_overview_jobs          | error_message text,
    batch_id uuid,
    result jsonb,
    completed_at timestamp with time zone,
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    status text NOT NULL DEFAULT 'pending'::text,
    created_at timestamp with time zone DEFAULT now(),
    term_id bigint NOT NULL,
    account_id uuid,
    company_id bigint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public       | ai_overview_terms_test    | status text NOT NULL DEFAULT 'ACTIVE'::text,
    id bigint NOT NULL,
    company_id bigint NOT NULL,
    account_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    last_checked_at timestamp with time zone,
    estimated_volume integer,
    estimated_relevance numeric,
    estimated_difficulty numeric,
    term text NOT NULL,
    source text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| public       | ai_overview_tracking_test | id bigint NOT NULL,
    competitor_mentions ARRAY DEFAULT '{}'::text[],
    checked_at timestamp with time zone DEFAULT now(),
    company_mentioned boolean NOT NULL DEFAULT false,
    url text,
    account_id uuid NOT NULL,
    has_ai_overview boolean NOT NULL DEFAULT false,
    content_snapshot text,
    company_id bigint NOT NULL,
    term_id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | batch_metadata            | metadata jsonb,
    batch_id uuid NOT NULL,
    company_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    completed_at timestamp with time zone,
    error_message text,
    account_id uuid,
    status text NOT NULL,
    batch_type text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public       | citations                 | page_authority integer,
    spam_score integer,
    root_domains_to_root_domain integer,
    external_links_to_root_domain integer,
    moz_last_crawled timestamp with time zone,
    moz_last_updated timestamp with time zone,
    content_scraped_at timestamp with time zone,
    content_analysis_updated_at timestamp with time zone,
    is_original boolean DEFAULT true,
    origin_citation_id bigint,
    account_id uuid,
    response_text text,
    icp_vertical text,
    rank_list text,
    answer_engine text,
    mentioned_companies_count ARRAY,
    content_scraping_error text,
    content_markdown text,
    content_analysis text,
    query_text text,
    region text,
    id bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    citation_order integer NOT NULL,
    response_analysis_id bigint NOT NULL,
    company_id bigint NOT NULL,
    recommended boolean,
    company_mentioned boolean,
    ranking_position integer,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    domain_authority bigint,
    source_type USER-DEFINED NOT NULL DEFAULT 'EARNED'::citation_source_type,
    mentioned_companies ARRAY,
    buyer_journey_phase text,
    buyer_persona text,
    citation_url text NOT NULL                                                                                                                                                                                                                                                                                                                                                                   |
create table public.companies (
  id bigint generated always as identity not null,
  name text not null,
  industry text null,
  created_at timestamp with time zone null default now(),
  main_products text[] null,
  product_category text null,
  number_of_employees integer null,
  annual_revenue text null,
  markets_operating_in text[] null default '{}'::text[],
  account_id uuid null,
  setup_completed_at timestamp with time zone null,
  constraint companies_pkey primary key (id),
  constraint companies_account_id_fkey foreign KEY (account_id) references accounts (id),
  constraint valid_markets check (
    (
      markets_operating_in <@ array[
        'north_america'::text,
        'europe'::text,
        'asia_pacific'::text,
        'middle_east'::text,
        'latin_america'::text
      ]
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_companies_account_id on public.companies using btree (account_id) TABLESPACE pg_default;

create index IF not exists idx_companies_product_category on public.companies using btree (product_category) TABLESPACE pg_default;

create index IF not exists idx_companies_setup_completed on public.companies using btree (setup_completed_at) TABLESPACE pg_default;

create index IF not exists idx_companies_number_of_employees on public.companies using btree (number_of_employees) TABLESPACE pg_default;

create index IF not exists idx_companies_main_products on public.companies using gin (main_products) TABLESPACE pg_default;

create index IF not exists idx_companies_markets on public.companies using gin (markets_operating_in) TABLESPACE pg_default;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public       | competitors               | competitor_name text NOT NULL,
    account_id uuid,
    company_id bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | generation_progress       | updated_at timestamp with time zone DEFAULT now(),
    status text NOT NULL,
    error_message text,
    account_id uuid,
    created_at timestamp with time zone DEFAULT now(),
    progress integer NOT NULL,
    id bigint NOT NULL,
    company_id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | ideal_customer_profiles   | region text NOT NULL,
    id bigint NOT NULL,
    company_size text NOT NULL,
    vertical text NOT NULL,
    icp_batch_id uuid DEFAULT gen_random_uuid(),
    account_id uuid,
    created_by_batch boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now(),
    company_id bigint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public       | persona_response_stats    | total_questions bigint,
    questions_with_responses bigint,
    latest_response_date timestamp with time zone,
    persona_title text,
    total_batches bigint,
    persona_id bigint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | personas                  | id bigint NOT NULL,
    department text NOT NULL,
    account_id uuid,
    icp_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    seniority_level text NOT NULL,
    title text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | products                  | account_id uuid,
    product_category text,
    created_at timestamp with time zone DEFAULT now(),
    name text NOT NULL,
    id bigint NOT NULL,
    company_id bigint NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | prompt_logs               | system_prompt text NOT NULL,
    persona_id bigint,
    company_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    id bigint NOT NULL,
    prompt_template_ids ARRAY NOT NULL,
    user_prompt text NOT NULL,
    context_data jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | prompts                   | prompt_type text,
    name text NOT NULL,
    prompt_text text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    is_active boolean DEFAULT false,
    id bigint NOT NULL,
    updated_at timestamp with time zone DEFAULT now()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public       | queries                   | company_id bigint,
    account_id uuid,
    product_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    id bigint NOT NULL,
    buyer_journey_phase ARRAY,
    persona_id bigint,
    query_text text NOT NULL,
    prompt_id bigint,
    user_id uuid,
    query_batch_id uuid DEFAULT gen_random_uuid(),
    created_by_batch boolean DEFAULT false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public       | response_analysis         | rank_list text,
    response_id bigint,
    product_id bigint,
    account_id uuid,
    created_by_batch boolean DEFAULT false,
    analysis_batch_id uuid,
    solution_analysis jsonb,
    prompt_id bigint,
    query_id bigint,
    company_id bigint NOT NULL,
    company_mentioned boolean DEFAULT false,
    id bigint NOT NULL,
    geographic_region text,
    industry_vertical text,
    buyer_persona text,
    buying_journey_stage text,
    response_text text,
    ranking_position integer,
    answer_engine text NOT NULL,
    query_text text,
    sentiment_score double precision,
    company_name text NOT NULL,
    prompt_name text,
    competitors_list ARRAY DEFAULT '{}'::text[],
    mentioned_companies ARRAY DEFAULT '{}'::text[],
    created_at timestamp with time zone DEFAULT now(),
    icp_vertical text,
    cited boolean,
    recommended boolean,
    citations_parsed jsonb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| public       | response_analysis_view    | geographic_region text,
    industry_vertical text,
    created_at timestamp with time zone,
    company_mentioned boolean,
    recommended boolean,
    citations_parsed jsonb,
    id bigint,
    buying_journey_stage text,
    buyer_persona text,
    response_id bigint,
    sentiment_score double precision,
    ranking_position integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | responses                 | answer_engine text,
    citations ARRAY,
    url text,
    websearchqueries ARRAY,
    id bigint NOT NULL,
    query_id bigint,
    created_at timestamp with time zone DEFAULT now(),
    response_batch_id uuid DEFAULT gen_random_uuid(),
    created_by_batch boolean DEFAULT false,
    account_id uuid,
    response_text text NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |